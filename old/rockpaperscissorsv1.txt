//Rock breaks Scissors
//Scissors cuts paper
//Paper covers Rock
//Rock = 1, Paper = 2, Scissor = 3
pragma solidity ^0.4.13;


contract RockPaperScissors {

    address public owner;

    struct Player {
        uint256 game;
        uint8 move;
        bool isWinner;
        uint256 jackpot;
    }

    mapping(address => Player) public players;

    uint8[3][3] public gameLogic;

    event LogGamedPlayed(address player, uint256 jackpot);
    event LogWinner(address winner);

    function RockPaperScissors()
    public
    {
        owner = msg.sender;
        gameLogic[0] = [0, 0, 1];
        gameLogic[1] = [1, 0, 0];
        gameLogic[2] = [0, 1, 0];
    }

    function play(uint256 _game, uint8 _move)
    public
    payable
    returns(bool success)
    {
        require(msg.sender != 0);
        require(0 < _move && _move < 4);
        //require(players[msg.sender].jackpot > 0);

        players[msg.sender].move = _move - 1;
        players[msg.sender].jackpot = msg.value;

        LogGamedPlayed(msg.sender, msg.value);
        return true;

    }

    function didIWin(address _player2)
    public
    returns(bool winner)
    {
        require(msg.sender != 0 && _player2 != 0);
        require(players[msg.sender].jackpot == players[_player2].jackpot);

        if (gameLogic[players[msg.sender].move][players[_player2].move] == 1) {
            players[msg.sender].isWinner = true;
            players[msg.sender].jackpot += players[msg.sender].jackpot;
            players[_player2].jackpot = 0;
            players[_player2].move = 0;
        }

        return players[msg.sender].isWinner;

    }

    function withdraw()
    public
    returns(bool success)
    {
        require(msg.sender != 0);
        require(players[msg.sender].isWinner);
        bool youWin;
        uint256 amountToSend;
        players[msg.sender].move = 0;
        youWin = players[msg.sender].isWinner;
        amountToSend = players[msg.sender].jackpot;
        players[msg.sender].isWinner = false;
        players[msg.sender].jackpot = 0;
        msg.sender.transfer(amountToSend);

        LogWinner(msg.sender);
        return true;
    }

}
